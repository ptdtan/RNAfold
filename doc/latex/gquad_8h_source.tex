\hypertarget{gquad_8h_source}{}\section{gquad.\+h}
\label{gquad_8h_source}\index{Vienna\+R\+N\+A/gquad.\+h@{Vienna\+R\+N\+A/gquad.\+h}}

\begin{DoxyCode}
00001 \textcolor{preprocessor}{#ifndef VIENNA\_RNA\_PACKAGE\_GQUAD\_H}
00002 \textcolor{preprocessor}{#define VIENNA\_RNA\_PACKAGE\_GQUAD\_H}
00003 
00004 \textcolor{preprocessor}{#include <\hyperlink{data__structures_8h}{ViennaRNA/data\_structures.h}>}
00005 \textcolor{preprocessor}{#include <\hyperlink{params_8h}{ViennaRNA/params.h}>}
00006 
00007 \textcolor{preprocessor}{#ifndef INLINE}
00008 \textcolor{preprocessor}{#ifdef \_\_GNUC\_\_}
00009 \textcolor{preprocessor}{# define INLINE inline}
00010 \textcolor{preprocessor}{#else}
00011 \textcolor{preprocessor}{# define INLINE}
00012 \textcolor{preprocessor}{#endif}
00013 \textcolor{preprocessor}{#endif}
00014 
00025 \textcolor{keywordtype}{int}         E\_gquad(\textcolor{keywordtype}{int} L,
00026                     \textcolor{keywordtype}{int} l[3],
00027                     \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t} *P);
00028 
00029 \hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL} exp\_E\_gquad( \textcolor{keywordtype}{int} L,
00030                         \textcolor{keywordtype}{int} l[3],
00031                         \hyperlink{group__energy__parameters_structvrna__exp__param__s}{vrna\_exp\_param\_t} *pf);
00032 
00033 \textcolor{keywordtype}{int}         E\_gquad\_ali(\textcolor{keywordtype}{int} i,
00034                         \textcolor{keywordtype}{int} L,
00035                         \textcolor{keywordtype}{int} l[3],
00036                         \textcolor{keyword}{const} \textcolor{keywordtype}{short} **S,
00037                         \textcolor{keywordtype}{int} n\_seq,
00038                         \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t} *P);
00039 
00040 
00041 \textcolor{keywordtype}{void}        E\_gquad\_ali\_en( \textcolor{keywordtype}{int} i,
00042                             \textcolor{keywordtype}{int} L,
00043                             \textcolor{keywordtype}{int} l[3],
00044                             \textcolor{keyword}{const} \textcolor{keywordtype}{short} **S,
00045                             \textcolor{keywordtype}{int} n\_seq,
00046                             \textcolor{keywordtype}{int} en[2],
00047                             \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t} *P);
00048 
00065 \textcolor{keywordtype}{int}         *\hyperlink{group__loops_ga392e45c9615aa123737671603fa4203c}{get\_gquad\_matrix}(\textcolor{keywordtype}{short} *S, \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t} *P);
00066 
00067 \textcolor{keywordtype}{int}         *get\_gquad\_ali\_matrix(\textcolor{keywordtype}{short} *S\_cons,
00068                                   \textcolor{keywordtype}{short} **S,
00069                                   \textcolor{keywordtype}{int} n\_seq,
00070                                   \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t} *P);
00071 
00072 \hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL}  *get\_gquad\_pf\_matrix( \textcolor{keywordtype}{short} *S,
00073                                   \hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL} *scale,
00074                                   \hyperlink{group__energy__parameters_structvrna__exp__param__s}{vrna\_exp\_param\_t} *pf);
00075 
00076 \textcolor{keywordtype}{int}         **get\_gquad\_L\_matrix( \textcolor{keywordtype}{short} *S,
00077                                   \textcolor{keywordtype}{int} start,
00078                                   \textcolor{keywordtype}{int} maxdist,
00079                                   \textcolor{keywordtype}{int} n,
00080                                   \textcolor{keywordtype}{int} **g,
00081                                   \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t} *P);
00082 
00083 \textcolor{keywordtype}{void}        vrna\_gquad\_mx\_local\_update( \hyperlink{group__fold__compound_structvrna__fc__s}{vrna\_fold\_compound\_t} *vc,
00084                                         \textcolor{keywordtype}{int} start);
00085 
00086 \textcolor{keywordtype}{void}        get\_gquad\_pattern\_mfe(\textcolor{keywordtype}{short} *S,
00087                                   \textcolor{keywordtype}{int} i,
00088                                   \textcolor{keywordtype}{int} j,
00089                                   \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t} *P,
00090                                   \textcolor{keywordtype}{int} *L,
00091                                   \textcolor{keywordtype}{int} l[3]);
00092 
00093 \textcolor{keywordtype}{void}
00094 get\_gquad\_pattern\_exhaustive( \textcolor{keywordtype}{short} *S,
00095                               \textcolor{keywordtype}{int} i,
00096                               \textcolor{keywordtype}{int} j,
00097                               \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t} *P,
00098                               \textcolor{keywordtype}{int} *L,
00099                               \textcolor{keywordtype}{int} *l,
00100                               \textcolor{keywordtype}{int} threshold);
00101 
00102 \textcolor{keywordtype}{void}        get\_gquad\_pattern\_pf( \textcolor{keywordtype}{short} *S,
00103                                   \textcolor{keywordtype}{int} i,
00104                                   \textcolor{keywordtype}{int} j,
00105                                   \hyperlink{group__energy__parameters_structvrna__exp__param__s}{vrna\_exp\_param\_t} *pf,
00106                                   \textcolor{keywordtype}{int} *L,
00107                                   \textcolor{keywordtype}{int} l[3]);
00108 
00109 \hyperlink{group__data__structures_structvrna__plist__s}{plist}       *get\_plist\_gquad\_from\_pr( \textcolor{keywordtype}{short} *S,
00110                                       \textcolor{keywordtype}{int} gi,
00111                                       \textcolor{keywordtype}{int} gj,
00112                                       \hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL} *G,
00113                                       \hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL} *probs,
00114                                       \hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL} *scale,
00115                                       \hyperlink{group__energy__parameters_structvrna__exp__param__s}{vrna\_exp\_param\_t} *pf);
00116 \hyperlink{group__data__structures_structvrna__plist__s}{plist}       *get\_plist\_gquad\_from\_pr\_max(\textcolor{keywordtype}{short} *S,
00117                                       \textcolor{keywordtype}{int} gi,
00118                                       \textcolor{keywordtype}{int} gj,
00119                                       \hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL} *G,
00120                                       \hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL} *probs,
00121                                       \hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL} *scale,
00122                                       \textcolor{keywordtype}{int} *L,
00123                                       \textcolor{keywordtype}{int} l[3],
00124                                       \hyperlink{group__energy__parameters_structvrna__exp__param__s}{vrna\_exp\_param\_t} *pf);
00125 
00126 \hyperlink{group__data__structures_structvrna__plist__s}{plist}       *get\_plist\_gquad\_from\_db( \textcolor{keyword}{const} \textcolor{keywordtype}{char} *structure,
00127                                       \textcolor{keywordtype}{float} \hyperlink{fold__vars_8h_ac98ec419070aee6831b44e5c700f090f}{pr});
00128 
00129 \textcolor{keywordtype}{int}         get\_gquad\_count(\textcolor{keywordtype}{short} *S,
00130                             \textcolor{keywordtype}{int} i,
00131                             \textcolor{keywordtype}{int} j);
00132 
00133 \textcolor{keywordtype}{int}         get\_gquad\_layer\_count(\textcolor{keywordtype}{short} *S,
00134                             \textcolor{keywordtype}{int} i,
00135                             \textcolor{keywordtype}{int} j);
00136 
00137 
00148 \textcolor{keywordtype}{int}         \hyperlink{group__loops_gae41763215b9c64d2a7b67f0df8a28078}{parse\_gquad}(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *struc, \textcolor{keywordtype}{int} *L, \textcolor{keywordtype}{int} l[3]);
00149 
00150 INLINE  PRIVATE \textcolor{keywordtype}{int} \hyperlink{group__loops_ga220c41e8dbcee940ac975b8ce88e55c5}{backtrack\_GQuad\_IntLoop}(\textcolor{keywordtype}{int} c,
00151                                             \textcolor{keywordtype}{int} i,
00152                                             \textcolor{keywordtype}{int} j,
00153                                             \textcolor{keywordtype}{int} type,
00154                                             \textcolor{keywordtype}{short} *S,
00155                                             \textcolor{keywordtype}{int} *ggg,
00156                                             \textcolor{keywordtype}{int} *index,
00157                                             \textcolor{keywordtype}{int} *p,
00158                                             \textcolor{keywordtype}{int} *q,
00159                                             \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t} *P);
00160 
00161 INLINE  PRIVATE \textcolor{keywordtype}{int} \hyperlink{group__loops_ga7b371308fa5a45c7ac353ef6ed1014de}{backtrack\_GQuad\_IntLoop\_L}(\textcolor{keywordtype}{int} c,
00162                                               \textcolor{keywordtype}{int} i,
00163                                               \textcolor{keywordtype}{int} j,
00164                                               \textcolor{keywordtype}{int} type,
00165                                               \textcolor{keywordtype}{short} *S,
00166                                               \textcolor{keywordtype}{int} **ggg,
00167                                               \textcolor{keywordtype}{int} maxdist,
00168                                               \textcolor{keywordtype}{int} *p,
00169                                               \textcolor{keywordtype}{int} *q,
00170                                               \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t} *P);
00171 
00172 PRIVATE INLINE \textcolor{keywordtype}{int}
00173 vrna\_BT\_gquad\_mfe(\hyperlink{group__fold__compound_structvrna__fc__s}{vrna\_fold\_compound\_t} *vc,
00174                   \textcolor{keywordtype}{int} i,
00175                   \textcolor{keywordtype}{int} j,
00176                   \hyperlink{group__data__structures_structvrna__bp__stack__s}{vrna\_bp\_stack\_t} *bp\_stack,
00177                   \textcolor{keywordtype}{int} *stack\_count);
00178 
00179 PRIVATE INLINE \textcolor{keywordtype}{int}
00180 vrna\_BT\_gquad\_int(\hyperlink{group__fold__compound_structvrna__fc__s}{vrna\_fold\_compound\_t} *vc,
00181                   \textcolor{keywordtype}{int} i,
00182                   \textcolor{keywordtype}{int} j,
00183                   \textcolor{keywordtype}{int} en,
00184                   \hyperlink{group__data__structures_structvrna__bp__stack__s}{vrna\_bp\_stack\_t} *bp\_stack,
00185                   \textcolor{keywordtype}{int} *stack\_count);
00186 
00187 PRIVATE INLINE \textcolor{keywordtype}{int}
00188 vrna\_BT\_gquad\_mfe(\hyperlink{group__fold__compound_structvrna__fc__s}{vrna\_fold\_compound\_t} *vc,
00189                   \textcolor{keywordtype}{int} i,
00190                   \textcolor{keywordtype}{int} j,
00191                   \hyperlink{group__data__structures_structvrna__bp__stack__s}{vrna\_bp\_stack\_t} *bp\_stack,
00192                   \textcolor{keywordtype}{int} *stack\_count)\{
00193 
00194   \textcolor{comment}{/*}
00195 \textcolor{comment}{    here we do some fancy stuff to backtrace the stacksize and linker lengths}
00196 \textcolor{comment}{    of the g-quadruplex that should reside within position i,j}
00197 \textcolor{comment}{  */}
00198   \textcolor{keywordtype}{short}         *S;
00199   \textcolor{keywordtype}{int}           l[3], L, a;
00200   \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t}  *P;
00201 
00202   P = vc->\hyperlink{group__fold__compound_a19b8720c2c5321c1b97c830bd17566ea}{params};
00203   S = vc->sequence\_encoding2;
00204   L = -1;
00205 
00206   get\_gquad\_pattern\_mfe(S, i, j, P, &L, l);
00207 
00208   \textcolor{keywordflow}{if}(L != -1)\{
00209     \textcolor{comment}{/* fill the G's of the quadruplex into base\_pair2 */}
00210     \textcolor{keywordflow}{for}(a=0;a<L;a++)\{
00211       bp\_stack[++(*stack\_count)].i = i+a;
00212       bp\_stack[(*stack\_count)].j   = i+a;
00213       bp\_stack[++(*stack\_count)].i = i+L+l[0]+a;
00214       bp\_stack[(*stack\_count)].j   = i+L+l[0]+a;
00215       bp\_stack[++(*stack\_count)].i = i+L+l[0]+L+l[1]+a;
00216       bp\_stack[(*stack\_count)].j   = i+L+l[0]+L+l[1]+a;
00217       bp\_stack[++(*stack\_count)].i = i+L+l[0]+L+l[1]+L+l[2]+a;
00218       bp\_stack[(*stack\_count)].j   = i+L+l[0]+L+l[1]+L+l[2]+a;
00219     \}
00220     \textcolor{keywordflow}{return} 1;
00221   \} \textcolor{keywordflow}{else} \{
00222     \textcolor{keywordflow}{return} 0;
00223   \}
00224 \}
00225 
00226 PRIVATE INLINE \textcolor{keywordtype}{int}
00227 vrna\_BT\_gquad\_int(\hyperlink{group__fold__compound_structvrna__fc__s}{vrna\_fold\_compound\_t} *vc,
00228                   \textcolor{keywordtype}{int} i,
00229                   \textcolor{keywordtype}{int} j,
00230                   \textcolor{keywordtype}{int} en,
00231                   \hyperlink{group__data__structures_structvrna__bp__stack__s}{vrna\_bp\_stack\_t} *bp\_stack,
00232                   \textcolor{keywordtype}{int} *stack\_count)\{
00233 
00234   \textcolor{keywordtype}{int}           energy, \hyperlink{group__model__details_ga72b511ed1201f7e23ec437e468790d74}{dangles}, *idx, ij, p, q, maxl, minl, c0, l1, *rtype, *ggg;
00235   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} type;
00236   \textcolor{keywordtype}{char}          *ptype;
00237   \textcolor{keywordtype}{short}         si, sj, *S, *S1;
00238 
00239   \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t}  *P;
00240   \hyperlink{group__model__details_structvrna__md__s}{vrna\_md\_t}     *md;
00241 
00242   idx         = vc->\hyperlink{group__fold__compound_a5037235dee512efd85ca543780bbca1a}{jindx};
00243   ij          = idx[j] + i;
00244   P           = vc->\hyperlink{group__fold__compound_a19b8720c2c5321c1b97c830bd17566ea}{params};
00245   md          = &(P->\hyperlink{group__energy__parameters_a7b84353eb9075c595bad4ceb871bcae7}{model\_details});
00246   ptype       = vc->\hyperlink{group__fold__compound_a3fbea559f1d1976b2d67c215cdeee0b2}{ptype};
00247   rtype       = &(md->\hyperlink{group__model__details_ad082d0fea31e002b90cdfe5e6382f8b0}{rtype}[0]);
00248   type        = rtype[(\textcolor{keywordtype}{unsigned} char)ptype[ij]];
00249   S1          = vc->\hyperlink{group__fold__compound_a9934bdb695d35a3544285cbcc19f9763}{sequence\_encoding};
00250   S           = vc->sequence\_encoding2;
00251   dangles     = md->\hyperlink{group__model__details_adcda4ff2ea77748ae0e8700288282efc}{dangles};
00252   si          = S1[i + 1];
00253   sj          = S1[j - 1];
00254   ggg         = vc->\hyperlink{group__fold__compound_aca8be7bdc65bafe2172c6ee777f18568}{matrices}->\hyperlink{group__dp__matrices_a0b7b86a5c75c96eabb89eb53a13e7164}{ggg};
00255   energy      = 0;
00256 
00257   \textcolor{keywordflow}{if}(dangles == 2)
00258     energy += P->mismatchI[type][si][sj];
00259 
00260   \textcolor{keywordflow}{if}(type > 2)
00261     energy += P->TerminalAU;
00262 
00263   p = i + 1;
00264   \textcolor{keywordflow}{if}(S1[p] == 3)\{
00265     \textcolor{keywordflow}{if}(p < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE)\{
00266       minl  = j - i + p - \hyperlink{energy__const_8h_ad1bd6eabac419670ddd3c9ed82145988}{MAXLOOP} - 2;
00267       c0    = p + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
00268       minl  = \hyperlink{group__utils_gadd91367918fadbc8d585940d6206d6d2}{MAX2}(c0, minl);
00269       c0    = j - 3;
00270       maxl  = p + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
00271       maxl  = \hyperlink{group__utils_ga2dd4a927a7f937f43a90c144d79107d8}{MIN2}(c0, maxl);
00272       \textcolor{keywordflow}{for}(q = minl; q < maxl; q++)\{
00273         \textcolor{keywordflow}{if}(S[q] != 3) \textcolor{keywordflow}{continue};
00274         \textcolor{keywordflow}{if}(en == energy + ggg[idx[q] + p] + P->internal\_loop[j - q - 1])\{
00275           \textcolor{keywordflow}{return} vrna\_BT\_gquad\_mfe(vc, p, q, bp\_stack, stack\_count);
00276         \}
00277       \}
00278     \}
00279   \}
00280 
00281   \textcolor{keywordflow}{for}(p = i + 2;
00282       p < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE;
00283       p++)\{
00284     l1    = p - i - 1;
00285     \textcolor{keywordflow}{if}(l1>MAXLOOP) \textcolor{keywordflow}{break};
00286     \textcolor{keywordflow}{if}(S1[p] != 3) \textcolor{keywordflow}{continue};
00287     minl  = j - i + p - MAXLOOP - 2;
00288     c0    = p + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
00289     minl  = \hyperlink{group__utils_gadd91367918fadbc8d585940d6206d6d2}{MAX2}(c0, minl);
00290     c0    = j - 1;
00291     maxl  = p + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
00292     maxl  = \hyperlink{group__utils_ga2dd4a927a7f937f43a90c144d79107d8}{MIN2}(c0, maxl);
00293     \textcolor{keywordflow}{for}(q = minl; q < maxl; q++)\{
00294       \textcolor{keywordflow}{if}(S1[q] != 3) \textcolor{keywordflow}{continue};
00295       \textcolor{keywordflow}{if}(en == energy + ggg[idx[q] + p] + P->internal\_loop[l1 + j - q - 1])\{
00296         \textcolor{keywordflow}{return} vrna\_BT\_gquad\_mfe(vc, p, q, bp\_stack, stack\_count);
00297       \}
00298     \}
00299   \}
00300 
00301   q = j - 1;
00302   \textcolor{keywordflow}{if}(S1[q] == 3)
00303     \textcolor{keywordflow}{for}(p = i + 4;
00304         p < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE;
00305         p++)\{
00306       l1    = p - i - 1;
00307       \textcolor{keywordflow}{if}(l1>MAXLOOP) \textcolor{keywordflow}{break};
00308       \textcolor{keywordflow}{if}(S1[p] != 3) \textcolor{keywordflow}{continue};
00309       \textcolor{keywordflow}{if}(en == energy + ggg[idx[q] + p] + P->internal\_loop[l1])\{
00310         \textcolor{keywordflow}{return} vrna\_BT\_gquad\_mfe(vc, p, q, bp\_stack, stack\_count);
00311       \}
00312     \}
00313 
00314   \textcolor{keywordflow}{return} 0;
00315 \}
00316 
\hypertarget{gquad_8h_source.tex_l00334}{}\hyperlink{group__loops_ga220c41e8dbcee940ac975b8ce88e55c5}{00334} INLINE  PRIVATE \textcolor{keywordtype}{int} \hyperlink{group__loops_ga220c41e8dbcee940ac975b8ce88e55c5}{backtrack\_GQuad\_IntLoop}(\textcolor{keywordtype}{int} c,
00335                                             \textcolor{keywordtype}{int} i,
00336                                             \textcolor{keywordtype}{int} j,
00337                                             \textcolor{keywordtype}{int} type,
00338                                             \textcolor{keywordtype}{short} *S,
00339                                             \textcolor{keywordtype}{int} *ggg,
00340                                             \textcolor{keywordtype}{int} *index,
00341                                             \textcolor{keywordtype}{int} *p,
00342                                             \textcolor{keywordtype}{int} *q,
00343                                             \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t} *P)\{
00344 
00345   \textcolor{keywordtype}{int} energy, \hyperlink{group__model__details_ga72b511ed1201f7e23ec437e468790d74}{dangles}, k, l, maxl, minl, c0, l1;
00346   \textcolor{keywordtype}{short} si, sj;
00347 
00348   dangles = P->\hyperlink{group__energy__parameters_a7b84353eb9075c595bad4ceb871bcae7}{model\_details}.\hyperlink{group__model__details_adcda4ff2ea77748ae0e8700288282efc}{dangles};
00349   si      = S[i + 1];
00350   sj      = S[j - 1];
00351   energy  = 0;
00352 
00353   \textcolor{keywordflow}{if}(dangles == 2)
00354     energy += P->mismatchI[type][si][sj];
00355 
00356   \textcolor{keywordflow}{if}(type > 2)
00357     energy += P->TerminalAU;
00358 
00359   k = i + 1;
00360   \textcolor{keywordflow}{if}(S[k] == 3)\{
00361     \textcolor{keywordflow}{if}(k < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE)\{
00362       minl  = j - i + k - MAXLOOP - 2;
00363       c0    = k + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
00364       minl  = \hyperlink{group__utils_gadd91367918fadbc8d585940d6206d6d2}{MAX2}(c0, minl);
00365       c0    = j - 3;
00366       maxl  = k + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
00367       maxl  = \hyperlink{group__utils_ga2dd4a927a7f937f43a90c144d79107d8}{MIN2}(c0, maxl);
00368       \textcolor{keywordflow}{for}(l = minl; l < maxl; l++)\{
00369         \textcolor{keywordflow}{if}(S[l] != 3) \textcolor{keywordflow}{continue};
00370         \textcolor{keywordflow}{if}(c == energy + ggg[index[l] + k] + P->internal\_loop[j - l - 1])\{
00371           *p = k; *q = l;
00372           \textcolor{keywordflow}{return} 1;
00373         \}
00374       \}
00375     \}
00376   \}
00377 
00378   \textcolor{keywordflow}{for}(k = i + 2;
00379       k < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE;
00380       k++)\{
00381     l1    = k - i - 1;
00382     \textcolor{keywordflow}{if}(l1>MAXLOOP) \textcolor{keywordflow}{break};
00383     \textcolor{keywordflow}{if}(S[k] != 3) \textcolor{keywordflow}{continue};
00384     minl  = j - i + k - MAXLOOP - 2;
00385     c0    = k + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
00386     minl  = \hyperlink{group__utils_gadd91367918fadbc8d585940d6206d6d2}{MAX2}(c0, minl);
00387     c0    = j - 1;
00388     maxl  = k + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
00389     maxl  = \hyperlink{group__utils_ga2dd4a927a7f937f43a90c144d79107d8}{MIN2}(c0, maxl);
00390     \textcolor{keywordflow}{for}(l = minl; l < maxl; l++)\{
00391       \textcolor{keywordflow}{if}(S[l] != 3) \textcolor{keywordflow}{continue};
00392       \textcolor{keywordflow}{if}(c == energy + ggg[index[l] + k] + P->internal\_loop[l1 + j - l - 1])\{
00393         *p = k; *q = l;
00394         \textcolor{keywordflow}{return} 1;
00395       \}
00396     \}
00397   \}
00398 
00399   l = j - 1;
00400   \textcolor{keywordflow}{if}(S[l] == 3)
00401     \textcolor{keywordflow}{for}(k = i + 4;
00402         k < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE;
00403         k++)\{
00404       l1    = k - i - 1;
00405       \textcolor{keywordflow}{if}(l1>MAXLOOP) \textcolor{keywordflow}{break};
00406       \textcolor{keywordflow}{if}(S[k] != 3) \textcolor{keywordflow}{continue};
00407       \textcolor{keywordflow}{if}(c == energy + ggg[index[l] + k] + P->internal\_loop[l1])\{
00408         *p = k; *q = l;
00409         \textcolor{keywordflow}{return} 1;
00410       \}
00411     \}
00412 
00413   \textcolor{keywordflow}{return} 0;
00414 \}
00415 
\hypertarget{gquad_8h_source.tex_l00432}{}\hyperlink{group__loops_ga7b371308fa5a45c7ac353ef6ed1014de}{00432} INLINE  PRIVATE \textcolor{keywordtype}{int} \hyperlink{group__loops_ga7b371308fa5a45c7ac353ef6ed1014de}{backtrack\_GQuad\_IntLoop\_L}(\textcolor{keywordtype}{int} c,
00433                                               \textcolor{keywordtype}{int} i,
00434                                               \textcolor{keywordtype}{int} j,
00435                                               \textcolor{keywordtype}{int} type,
00436                                               \textcolor{keywordtype}{short} *S,
00437                                               \textcolor{keywordtype}{int} **ggg,
00438                                               \textcolor{keywordtype}{int} maxdist,
00439                                               \textcolor{keywordtype}{int} *p,
00440                                               \textcolor{keywordtype}{int} *q,
00441                                               \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t} *P)\{
00442 
00443   \textcolor{keywordtype}{int} energy, \hyperlink{group__model__details_ga72b511ed1201f7e23ec437e468790d74}{dangles}, k, l, maxl, minl, c0, l1;
00444   \textcolor{keywordtype}{short} si, sj;
00445 
00446   dangles = P->\hyperlink{group__energy__parameters_a7b84353eb9075c595bad4ceb871bcae7}{model\_details}.\hyperlink{group__model__details_adcda4ff2ea77748ae0e8700288282efc}{dangles};
00447   si      = S[i + 1];
00448   sj      = S[j - 1];
00449   energy  = 0;
00450 
00451   \textcolor{keywordflow}{if}(dangles == 2)
00452     energy += P->mismatchI[type][si][sj];
00453 
00454   \textcolor{keywordflow}{if}(type > 2)
00455     energy += P->TerminalAU;
00456 
00457   k = i + 1;
00458   \textcolor{keywordflow}{if}(S[k] == 3)\{
00459     \textcolor{keywordflow}{if}(k < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE)\{
00460       minl  = j - i + k - MAXLOOP - 2;
00461       c0    = k + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
00462       minl  = \hyperlink{group__utils_gadd91367918fadbc8d585940d6206d6d2}{MAX2}(c0, minl);
00463       c0    = j - 3;
00464       maxl  = k + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
00465       maxl  = \hyperlink{group__utils_ga2dd4a927a7f937f43a90c144d79107d8}{MIN2}(c0, maxl);
00466       \textcolor{keywordflow}{for}(l = minl; l < maxl; l++)\{
00467         \textcolor{keywordflow}{if}(S[l] != 3) \textcolor{keywordflow}{continue};
00468         \textcolor{keywordflow}{if}(c == energy + ggg[k][l - k] + P->internal\_loop[j - l - 1])\{
00469           *p = k; *q = l;
00470           \textcolor{keywordflow}{return} 1;
00471         \}
00472       \}
00473     \}
00474   \}
00475 
00476   \textcolor{keywordflow}{for}(k = i + 2;
00477       k < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE;
00478       k++)\{
00479     l1    = k - i - 1;
00480     \textcolor{keywordflow}{if}(l1>MAXLOOP) \textcolor{keywordflow}{break};
00481     \textcolor{keywordflow}{if}(S[k] != 3) \textcolor{keywordflow}{continue};
00482     minl  = j - i + k - MAXLOOP - 2;
00483     c0    = k + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
00484     minl  = \hyperlink{group__utils_gadd91367918fadbc8d585940d6206d6d2}{MAX2}(c0, minl);
00485     c0    = j - 1;
00486     maxl  = k + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
00487     maxl  = \hyperlink{group__utils_ga2dd4a927a7f937f43a90c144d79107d8}{MIN2}(c0, maxl);
00488     \textcolor{keywordflow}{for}(l = minl; l < maxl; l++)\{
00489       \textcolor{keywordflow}{if}(S[l] != 3) \textcolor{keywordflow}{continue};
00490       \textcolor{keywordflow}{if}(c == energy + ggg[k][l - k] + P->internal\_loop[l1 + j - l - 1])\{
00491         *p = k; *q = l;
00492         \textcolor{keywordflow}{return} 1;
00493       \}
00494     \}
00495   \}
00496 
00497   l = j - 1;
00498   \textcolor{keywordflow}{if}(S[l] == 3)
00499     \textcolor{keywordflow}{for}(k = i + 4;
00500         k < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE;
00501         k++)\{
00502       l1    = k - i - 1;
00503       \textcolor{keywordflow}{if}(l1>MAXLOOP) \textcolor{keywordflow}{break};
00504       \textcolor{keywordflow}{if}(S[k] != 3) \textcolor{keywordflow}{continue};
00505       \textcolor{keywordflow}{if}(c == energy + ggg[k][l - k] + P->internal\_loop[l1])\{
00506         *p = k; *q = l;
00507         \textcolor{keywordflow}{return} 1;
00508       \}
00509     \}
00510 
00511   \textcolor{keywordflow}{return} 0;
00512 \}
00513 
00514 PRIVATE INLINE
00515 \textcolor{keywordtype}{int}
00516 E\_GQuad\_IntLoop(\textcolor{keywordtype}{int} i,
00517                 \textcolor{keywordtype}{int} j,
00518                 \textcolor{keywordtype}{int} type,
00519                 \textcolor{keywordtype}{short} *S,
00520                 \textcolor{keywordtype}{int} *ggg,
00521                 \textcolor{keywordtype}{int} *index,
00522                 \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t} *P)\{
00523 
00524   \textcolor{keywordtype}{int} energy, ge, \hyperlink{group__model__details_ga72b511ed1201f7e23ec437e468790d74}{dangles}, p, q, l1, minq, maxq, c0;
00525   \textcolor{keywordtype}{short} si, sj;
00526 
00527   dangles = P->\hyperlink{group__energy__parameters_a7b84353eb9075c595bad4ceb871bcae7}{model\_details}.\hyperlink{group__model__details_adcda4ff2ea77748ae0e8700288282efc}{dangles};
00528   si      = S[i + 1];
00529   sj      = S[j - 1];
00530   energy  = 0;
00531 
00532   \textcolor{keywordflow}{if}(dangles == 2)
00533     energy += P->mismatchI[type][si][sj];
00534 
00535   \textcolor{keywordflow}{if}(type > 2)
00536     energy += P->TerminalAU;
00537 
00538   ge = \hyperlink{energy__const_8h_a12c2040f25d8e3a7b9e1c2024c618cb6}{INF};
00539 
00540   p = i + 1;
00541   \textcolor{keywordflow}{if}(S[p] == 3)\{
00542     \textcolor{keywordflow}{if}(p < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE)\{
00543       minq  = j - i + p - MAXLOOP - 2;
00544       c0    = p + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
00545       minq  = \hyperlink{group__utils_gadd91367918fadbc8d585940d6206d6d2}{MAX2}(c0, minq);
00546       c0    = j - 3;
00547       maxq  = p + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
00548       maxq  = \hyperlink{group__utils_ga2dd4a927a7f937f43a90c144d79107d8}{MIN2}(c0, maxq);
00549       \textcolor{keywordflow}{for}(q = minq; q < maxq; q++)\{
00550         \textcolor{keywordflow}{if}(S[q] != 3) \textcolor{keywordflow}{continue};
00551         c0  = energy + ggg[index[q] + p] + P->internal\_loop[j - q - 1];
00552         ge  = \hyperlink{group__utils_ga2dd4a927a7f937f43a90c144d79107d8}{MIN2}(ge, c0);
00553       \}
00554     \}
00555   \}
00556 
00557   \textcolor{keywordflow}{for}(p = i + 2;
00558       p < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE;
00559       p++)\{
00560     l1    = p - i - 1;
00561     \textcolor{keywordflow}{if}(l1>MAXLOOP) \textcolor{keywordflow}{break};
00562     \textcolor{keywordflow}{if}(S[p] != 3) \textcolor{keywordflow}{continue};
00563     minq  = j - i + p - MAXLOOP - 2;
00564     c0    = p + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
00565     minq  = \hyperlink{group__utils_gadd91367918fadbc8d585940d6206d6d2}{MAX2}(c0, minq);
00566     c0    = j - 1;
00567     maxq  = p + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
00568     maxq  = \hyperlink{group__utils_ga2dd4a927a7f937f43a90c144d79107d8}{MIN2}(c0, maxq);
00569     \textcolor{keywordflow}{for}(q = minq; q < maxq; q++)\{
00570       \textcolor{keywordflow}{if}(S[q] != 3) \textcolor{keywordflow}{continue};
00571       c0  = energy + ggg[index[q] + p] + P->internal\_loop[l1 + j - q - 1];
00572       ge   = \hyperlink{group__utils_ga2dd4a927a7f937f43a90c144d79107d8}{MIN2}(ge, c0);
00573     \}
00574   \}
00575 
00576   q = j - 1;
00577   \textcolor{keywordflow}{if}(S[q] == 3)
00578     \textcolor{keywordflow}{for}(p = i + 4;
00579         p < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE;
00580         p++)\{
00581       l1    = p - i - 1;
00582       \textcolor{keywordflow}{if}(l1>MAXLOOP) \textcolor{keywordflow}{break};
00583       \textcolor{keywordflow}{if}(S[p] != 3) \textcolor{keywordflow}{continue};
00584       c0  = energy + ggg[index[q] + p] + P->internal\_loop[l1];
00585       ge  = \hyperlink{group__utils_ga2dd4a927a7f937f43a90c144d79107d8}{MIN2}(ge, c0);
00586     \}
00587 
00588 \textcolor{preprocessor}{#if 0}
00589   \textcolor{comment}{/* here comes the additional stuff for the odd dangle models */}
00590   \textcolor{keywordflow}{if}(dangles % 1)\{
00591     en1 = energy + P->dangle5[type][si];
00592     en2 = energy + P->dangle5[type][sj];
00593     en3 = energy + P->mismatchI[type][si][sj];
00594 
00595     \textcolor{comment}{/* first case with 5' dangle (i.e. j-1) onto enclosing pair */}
00596     p = i + 1;
00597     \textcolor{keywordflow}{if}(S[p] == 3)\{
00598       \textcolor{keywordflow}{if}(p < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE)\{
00599         minq  = j - i + p - MAXLOOP - 2;
00600         c0    = p + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
00601         minq  = \hyperlink{group__utils_gadd91367918fadbc8d585940d6206d6d2}{MAX2}(c0, minq);
00602         c0    = j - 4;
00603         maxq  = p + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
00604         maxq  = \hyperlink{group__utils_ga2dd4a927a7f937f43a90c144d79107d8}{MIN2}(c0, maxq);
00605         \textcolor{keywordflow}{for}(q = minq; q < maxq; q++)\{
00606           \textcolor{keywordflow}{if}(S[q] != 3) \textcolor{keywordflow}{continue};
00607           c0  = en1 + ggg[index[q] + p] + P->internal\_loop[j - q - 1];
00608           ge  = \hyperlink{group__utils_ga2dd4a927a7f937f43a90c144d79107d8}{MIN2}(ge, c0);
00609         \}
00610       \}
00611     \}
00612 
00613     \textcolor{keywordflow}{for}(p = i + 2; p < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE; p++)\{
00614       l1    = p - i - 1;
00615       \textcolor{keywordflow}{if}(l1>MAXLOOP) \textcolor{keywordflow}{break};
00616       \textcolor{keywordflow}{if}(S[p] != 3) \textcolor{keywordflow}{continue};
00617       minq  = j - i + p - MAXLOOP - 2;
00618       c0    = p + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
00619       minq  = \hyperlink{group__utils_gadd91367918fadbc8d585940d6206d6d2}{MAX2}(c0, minq);
00620       c0    = j - 2;
00621       maxq  = p + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
00622       maxq  = \hyperlink{group__utils_ga2dd4a927a7f937f43a90c144d79107d8}{MIN2}(c0, maxq);
00623       \textcolor{keywordflow}{for}(q = minq; q < maxq; q++)\{
00624         \textcolor{keywordflow}{if}(S[q] != 3) \textcolor{keywordflow}{continue};
00625         c0  = en1 + ggg[index[q] + p] + P->internal\_loop[l1 + j - q - 1];
00626         ge   = \hyperlink{group__utils_ga2dd4a927a7f937f43a90c144d79107d8}{MIN2}(ge, c0);
00627       \}
00628     \}
00629 
00630     q = j - 2;
00631     \textcolor{keywordflow}{if}(S[q] == 3)
00632       \textcolor{keywordflow}{for}(p = i + 4; p < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE; p++)\{
00633         l1    = p - i - 1;
00634         \textcolor{keywordflow}{if}(l1>MAXLOOP) \textcolor{keywordflow}{break};
00635         \textcolor{keywordflow}{if}(S[p] != 3) \textcolor{keywordflow}{continue};
00636         c0  = en1 + ggg[index[q] + p] + P->internal\_loop[l1 + 1];
00637         ge  = \hyperlink{group__utils_ga2dd4a927a7f937f43a90c144d79107d8}{MIN2}(ge, c0);
00638       \}
00639 
00640     \textcolor{comment}{/* second case with 3' dangle (i.e. i+1) onto enclosing pair */}
00641 
00642   \}
00643 \textcolor{preprocessor}{#endif}
00644   \textcolor{keywordflow}{return} ge;
00645 \}
00646 
00647 PRIVATE INLINE
00648 \textcolor{keywordtype}{int} *
00649 E\_GQuad\_IntLoop\_exhaustive( \textcolor{keywordtype}{int} i,
00650                             \textcolor{keywordtype}{int} j,
00651                             \textcolor{keywordtype}{int} **p\_p,
00652                             \textcolor{keywordtype}{int} **q\_p,
00653                             \textcolor{keywordtype}{int} type,
00654                             \textcolor{keywordtype}{short} *S,
00655                             \textcolor{keywordtype}{int} *ggg,
00656                             \textcolor{keywordtype}{int} threshold,
00657                             \textcolor{keywordtype}{int} *index,
00658                             \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t} *P)\{
00659 
00660   \textcolor{keywordtype}{int} energy, *ge, \hyperlink{group__model__details_ga72b511ed1201f7e23ec437e468790d74}{dangles}, p, q, l1, minq, maxq, c0;
00661   \textcolor{keywordtype}{short} si, sj;
00662   \textcolor{keywordtype}{int} cnt = 0;
00663 
00664   dangles = P->\hyperlink{group__energy__parameters_a7b84353eb9075c595bad4ceb871bcae7}{model\_details}.\hyperlink{group__model__details_adcda4ff2ea77748ae0e8700288282efc}{dangles};
00665   si      = S[i + 1];
00666   sj      = S[j - 1];
00667   energy  = 0;
00668 
00669   \textcolor{keywordflow}{if}(dangles == 2)
00670     energy += P->mismatchI[type][si][sj];
00671 
00672   \textcolor{keywordflow}{if}(type > 2)
00673     energy += P->TerminalAU;
00674 
00675   \textcolor{comment}{/* guess how many gquads are possible in interval [i+1,j-1] */}
00676   *p\_p  = (\textcolor{keywordtype}{int} *)\hyperlink{group__utils_gaf37a0979367c977edfb9da6614eebe99}{vrna\_alloc}(\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}) * 256);
00677   *q\_p  = (\textcolor{keywordtype}{int} *)\hyperlink{group__utils_gaf37a0979367c977edfb9da6614eebe99}{vrna\_alloc}(\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}) * 256);
00678   ge    = (\textcolor{keywordtype}{int} *)\hyperlink{group__utils_gaf37a0979367c977edfb9da6614eebe99}{vrna\_alloc}(\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}) * 256);
00679 
00680   p = i + 1;
00681   \textcolor{keywordflow}{if}(S[p] == 3)\{
00682     \textcolor{keywordflow}{if}(p < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE)\{
00683       minq  = j - i + p - MAXLOOP - 2;
00684       c0    = p + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
00685       minq  = \hyperlink{group__utils_gadd91367918fadbc8d585940d6206d6d2}{MAX2}(c0, minq);
00686       c0    = j - 3;
00687       maxq  = p + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
00688       maxq  = \hyperlink{group__utils_ga2dd4a927a7f937f43a90c144d79107d8}{MIN2}(c0, maxq);
00689       \textcolor{keywordflow}{for}(q = minq; q < maxq; q++)\{
00690         \textcolor{keywordflow}{if}(S[q] != 3) \textcolor{keywordflow}{continue};
00691         c0  = energy + ggg[index[q] + p] + P->internal\_loop[j - q - 1];
00692         \textcolor{keywordflow}{if}(c0 <= threshold)\{
00693           ge[cnt]       = energy + P->internal\_loop[j - q - 1];
00694           (*p\_p)[cnt]   = p;
00695           (*q\_p)[cnt++] = q;
00696         \}
00697       \}
00698     \}
00699   \}
00700 
00701   \textcolor{keywordflow}{for}(p = i + 2;
00702       p < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE;
00703       p++)\{
00704     l1    = p - i - 1;
00705     \textcolor{keywordflow}{if}(l1>MAXLOOP) \textcolor{keywordflow}{break};
00706     \textcolor{keywordflow}{if}(S[p] != 3) \textcolor{keywordflow}{continue};
00707     minq  = j - i + p - MAXLOOP - 2;
00708     c0    = p + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
00709     minq  = \hyperlink{group__utils_gadd91367918fadbc8d585940d6206d6d2}{MAX2}(c0, minq);
00710     c0    = j - 1;
00711     maxq  = p + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
00712     maxq  = \hyperlink{group__utils_ga2dd4a927a7f937f43a90c144d79107d8}{MIN2}(c0, maxq);
00713     \textcolor{keywordflow}{for}(q = minq; q < maxq; q++)\{
00714       \textcolor{keywordflow}{if}(S[q] != 3) \textcolor{keywordflow}{continue};
00715       c0  = energy + ggg[index[q] + p] + P->internal\_loop[l1 + j - q - 1];
00716         \textcolor{keywordflow}{if}(c0 <= threshold)\{
00717           ge[cnt]       = energy + P->internal\_loop[l1 + j - q - 1];
00718           (*p\_p)[cnt]   = p;
00719           (*q\_p)[cnt++] = q;
00720         \}
00721     \}
00722   \}
00723 
00724   q = j - 1;
00725   \textcolor{keywordflow}{if}(S[q] == 3)
00726     \textcolor{keywordflow}{for}(p = i + 4;
00727         p < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE;
00728         p++)\{
00729       l1    = p - i - 1;
00730       \textcolor{keywordflow}{if}(l1>MAXLOOP) \textcolor{keywordflow}{break};
00731       \textcolor{keywordflow}{if}(S[p] != 3) \textcolor{keywordflow}{continue};
00732       c0  = energy + ggg[index[q] + p] + P->internal\_loop[l1];
00733         \textcolor{keywordflow}{if}(c0 <= threshold)\{
00734           ge[cnt]       = energy + P->internal\_loop[l1];
00735           (*p\_p)[cnt]   = p;
00736           (*q\_p)[cnt++] = q;
00737         \}
00738     \}
00739 
00740 
00741   (*p\_p)[cnt] = -1;
00742 
00743   \textcolor{keywordflow}{return} ge;
00744 \}
00745 
00746 PRIVATE INLINE
00747 \textcolor{keywordtype}{int}
00748 E\_GQuad\_IntLoop\_L(\textcolor{keywordtype}{int} i,
00749                   \textcolor{keywordtype}{int} j,
00750                   \textcolor{keywordtype}{int} type,
00751                   \textcolor{keywordtype}{short} *S,
00752                   \textcolor{keywordtype}{int} **ggg,
00753                   \textcolor{keywordtype}{int} maxdist,
00754                   \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t} *P)\{
00755 
00756   \textcolor{keywordtype}{int} energy, ge, \hyperlink{group__model__details_ga72b511ed1201f7e23ec437e468790d74}{dangles}, p, q, l1, minq, maxq, c0;
00757   \textcolor{keywordtype}{short} si, sj;
00758 
00759   dangles = P->\hyperlink{group__energy__parameters_a7b84353eb9075c595bad4ceb871bcae7}{model\_details}.\hyperlink{group__model__details_adcda4ff2ea77748ae0e8700288282efc}{dangles};
00760   si      = S[i + 1];
00761   sj      = S[j - 1];
00762   energy  = 0;
00763 
00764   \textcolor{keywordflow}{if}(dangles == 2)
00765     energy += P->mismatchI[type][si][sj];
00766 
00767   \textcolor{keywordflow}{if}(type > 2)
00768     energy += P->TerminalAU;
00769 
00770   ge = \hyperlink{energy__const_8h_a12c2040f25d8e3a7b9e1c2024c618cb6}{INF};
00771 
00772   p = i + 1;
00773   \textcolor{keywordflow}{if}(S[p] == 3)\{
00774     \textcolor{keywordflow}{if}(p < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE)\{
00775       minq  = j - i + p - MAXLOOP - 2;
00776       c0    = p + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
00777       minq  = \hyperlink{group__utils_gadd91367918fadbc8d585940d6206d6d2}{MAX2}(c0, minq);
00778       c0    = j - 3;
00779       maxq  = p + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
00780       maxq  = \hyperlink{group__utils_ga2dd4a927a7f937f43a90c144d79107d8}{MIN2}(c0, maxq);
00781       \textcolor{keywordflow}{for}(q = minq; q < maxq; q++)\{
00782         \textcolor{keywordflow}{if}(S[q] != 3) \textcolor{keywordflow}{continue};
00783         c0  = energy + ggg[p][q-p] + P->internal\_loop[j - q - 1];
00784         ge  = \hyperlink{group__utils_ga2dd4a927a7f937f43a90c144d79107d8}{MIN2}(ge, c0);
00785       \}
00786     \}
00787   \}
00788 
00789   \textcolor{keywordflow}{for}(p = i + 2;
00790       p < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE;
00791       p++)\{
00792     l1    = p - i - 1;
00793     \textcolor{keywordflow}{if}(l1>MAXLOOP) \textcolor{keywordflow}{break};
00794     \textcolor{keywordflow}{if}(S[p] != 3) \textcolor{keywordflow}{continue};
00795     minq  = j - i + p - MAXLOOP - 2;
00796     c0    = p + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
00797     minq  = \hyperlink{group__utils_gadd91367918fadbc8d585940d6206d6d2}{MAX2}(c0, minq);
00798     c0    = j - 1;
00799     maxq  = p + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
00800     maxq  = \hyperlink{group__utils_ga2dd4a927a7f937f43a90c144d79107d8}{MIN2}(c0, maxq);
00801     \textcolor{keywordflow}{for}(q = minq; q < maxq; q++)\{
00802       \textcolor{keywordflow}{if}(S[q] != 3) \textcolor{keywordflow}{continue};
00803       c0  = energy + ggg[p][q - p] + P->internal\_loop[l1 + j - q - 1];
00804       ge   = \hyperlink{group__utils_ga2dd4a927a7f937f43a90c144d79107d8}{MIN2}(ge, c0);
00805     \}
00806   \}
00807 
00808   q = j - 1;
00809   \textcolor{keywordflow}{if}(S[q] == 3)
00810     \textcolor{keywordflow}{for}(p = i + 4;
00811         p < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE;
00812         p++)\{
00813       l1    = p - i - 1;
00814       \textcolor{keywordflow}{if}(l1>MAXLOOP) \textcolor{keywordflow}{break};
00815       \textcolor{keywordflow}{if}(S[p] != 3) \textcolor{keywordflow}{continue};
00816       c0  = energy + ggg[p][q - p] + P->internal\_loop[l1];
00817       ge  = \hyperlink{group__utils_ga2dd4a927a7f937f43a90c144d79107d8}{MIN2}(ge, c0);
00818     \}
00819 
00820   \textcolor{keywordflow}{return} ge;
00821 \}
00822 
00823 PRIVATE INLINE
00824 \hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL}
00825 exp\_E\_GQuad\_IntLoop(\textcolor{keywordtype}{int} i,
00826                     \textcolor{keywordtype}{int} j,
00827                     \textcolor{keywordtype}{int} type,
00828                     \textcolor{keywordtype}{short} *S,
00829                     \hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL} *G,
00830                     \textcolor{keywordtype}{int} *index,
00831                     \hyperlink{group__energy__parameters_structvrna__exp__param__s}{vrna\_exp\_param\_t} *pf)\{
00832 
00833   \textcolor{keywordtype}{int}         k, l, minl, maxl, u, r;
00834   \hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL}  q, qe;
00835   \textcolor{keywordtype}{double}      *expintern;
00836   \textcolor{keywordtype}{short}       si, sj;
00837 
00838   q         = 0;
00839   si        = S[i + 1];
00840   sj        = S[j - 1];
00841   qe        = (\hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL})pf->expmismatchI[type][si][sj];
00842   expintern = pf->expinternal;
00843 
00844   \textcolor{keywordflow}{if}(type > 2)
00845     qe *= (\hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL})pf->expTermAU;
00846 
00847   k = i + 1;
00848   \textcolor{keywordflow}{if}(S[k] == 3)\{
00849     \textcolor{keywordflow}{if}(k < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE)\{
00850       minl  = j - i + k - MAXLOOP - 2;
00851       u     = k + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
00852       minl  = \hyperlink{group__utils_gadd91367918fadbc8d585940d6206d6d2}{MAX2}(u, minl);
00853       u     = j - 3;
00854       maxl  = k + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
00855       maxl  = \hyperlink{group__utils_ga2dd4a927a7f937f43a90c144d79107d8}{MIN2}(u, maxl);
00856       \textcolor{keywordflow}{for}(l = minl; l < maxl; l++)\{
00857         \textcolor{keywordflow}{if}(S[l] != 3) \textcolor{keywordflow}{continue};
00858         \textcolor{keywordflow}{if}(G[index[k]-l] == 0.) \textcolor{keywordflow}{continue};
00859         q += qe * G[index[k]-l] * (\hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL})expintern[j - l - 1];
00860       \}
00861     \}
00862   \}
00863 
00864 
00865   \textcolor{keywordflow}{for}(k = i + 2;
00866       k <= j - VRNA\_GQUAD\_MIN\_BOX\_SIZE;
00867       k++)\{
00868     u = k - i - 1;
00869     \textcolor{keywordflow}{if}(u > MAXLOOP) \textcolor{keywordflow}{break};
00870     \textcolor{keywordflow}{if}(S[k] != 3) \textcolor{keywordflow}{continue};
00871     minl  = j - i + k - MAXLOOP - 2;
00872     r     = k + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
00873     minl  = \hyperlink{group__utils_gadd91367918fadbc8d585940d6206d6d2}{MAX2}(r, minl);
00874     maxl  = k + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
00875     r     = j - 1;
00876     maxl  = \hyperlink{group__utils_ga2dd4a927a7f937f43a90c144d79107d8}{MIN2}(r, maxl);
00877     \textcolor{keywordflow}{for}(l = minl; l < maxl; l++)\{
00878       \textcolor{keywordflow}{if}(S[l] != 3) \textcolor{keywordflow}{continue};
00879       \textcolor{keywordflow}{if}(G[index[k]-l] == 0.) \textcolor{keywordflow}{continue};
00880       q += qe * G[index[k]-l] * (\hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL})expintern[u + j - l - 1];
00881     \}
00882   \}
00883 
00884   l = j - 1;
00885   \textcolor{keywordflow}{if}(S[l] == 3)
00886     \textcolor{keywordflow}{for}(k = i + 4; k < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE; k++)\{
00887       u    = k - i - 1;
00888       \textcolor{keywordflow}{if}(u>MAXLOOP) \textcolor{keywordflow}{break};
00889       \textcolor{keywordflow}{if}(S[k] != 3) \textcolor{keywordflow}{continue};
00890       \textcolor{keywordflow}{if}(G[index[k]-l] == 0.) \textcolor{keywordflow}{continue};
00891       q += qe * G[index[k]-l] * (\hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL})expintern[u];
00892     \}
00893 
00894   \textcolor{keywordflow}{return} q;
00895 \}
00896 
00902 \textcolor{preprocessor}{#endif}
\end{DoxyCode}
